/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2021 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

!function(l){"use strict";l("#sidebarToggle, #sidebarToggleTop").on("click",function(e){l("body").toggleClass("sidebar-toggled"),l(".sidebar").toggleClass("toggled"),l(".sidebar").hasClass("toggled")&&l(".sidebar .collapse").collapse("hide")}),l(window).resize(function(){l(window).width()<768&&l(".sidebar .collapse").collapse("hide"),l(window).width()<480&&!l(".sidebar").hasClass("toggled")&&(l("body").addClass("sidebar-toggled"),l(".sidebar").addClass("toggled"),l(".sidebar .collapse").collapse("hide"))}),l("body.fixed-nav .sidebar").on("mousewheel DOMMouseScroll wheel",function(e){var o;768<l(window).width()&&(o=(o=e.originalEvent).wheelDelta||-o.detail,this.scrollTop+=30*(o<0?1:-1),e.preventDefault())}),l(document).on("scroll",function(){100<l(this).scrollTop()?l(".scroll-to-top").fadeIn():l(".scroll-to-top").fadeOut()}),l(document).on("click","a.scroll-to-top",function(e){var o=l(this);l("html, body").stop().animate({scrollTop:l(o.attr("href")).offset().top},1e3,"easeInOutExpo"),e.preventDefault()})}(jQuery);


// js biaya
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll(".edit-btn").forEach(button => {
        button.addEventListener("click", function() {
            let id = this.getAttribute("data-id");
            let nama = this.getAttribute("data-nama");
            let jumlah = this.getAttribute("data-jumlah");
            let status = this.getAttribute("data-status");

            document.getElementById("edit_nama_biaya").value = nama;
            document.getElementById("edit_jumlah").value = jumlah;
            document.getElementById("edit_status").value = status;

            let form = document.getElementById("editBiayaForm");
            form.action = `/admin/biaya/${id}`;
        });
    });
});


// js kelas
document.addEventListener('DOMContentLoaded', function () {
    const editButtons = document.querySelectorAll('.btn-edit');

    editButtons.forEach(button => {
        button.addEventListener('click', function () {
            const id = this.getAttribute('data-id');
            const nama = this.getAttribute('data-nama');
            const kompetensi = this.getAttribute('data-kompetensi');

            document.getElementById('edit-nama').value = nama;
            document.getElementById('edit-kompetensi').value = kompetensi;

            document.getElementById('formEdit').setAttribute('action', '/admin/kelas/' + id);
        });
    });
});

// js detail siswa
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll(".detail-btn").forEach(button => {
        button.addEventListener("click", function() {
            document.getElementById("modalNama").textContent = this.dataset.nama;
            document.getElementById("modalNisn").textContent = this.dataset.nisn;
            document.getElementById("modalNis").textContent = this.dataset.nis;
            document.getElementById("modalKelas").textContent = this.dataset.kelas;
            document.getElementById("modalAlamat").textContent = this.dataset.alamat;
            document.getElementById("modalTelepon").textContent = this.dataset.telepon;
            document.getElementById("modalWali").textContent = this.dataset.wali;

            let fotoSrc = this.dataset.foto;
            let modalFoto = document.getElementById("modalFoto");

            if (!fotoSrc || fotoSrc.includes("null") || fotoSrc.endsWith('/')) {
                modalFoto.src = "{{ asset('storage/profiles/avatar.png') }}"; // Foto default
            } else {
                modalFoto.src = fotoSrc;
            }
        });
    });
});



// js search siswa
$(document).ready(function () {
    $('#search-input').on('keyup', function () {
        let query = $(this).val();
        $.ajax({
            url: "{{ route('admin.siswa.index') }}",
            type: "GET",
            data: { search: query },
            success: function (response) {
                $('#siswa-list').html(response.html);
            }
        });
    });
});

// js edit siswa

$(document).ready(function () {
    $('.edit-btn').click(function () {
        var siswaId = $(this).data('id');

        $.ajax({
            url: `/admin/siswa/${siswaId}/edit`,
            type: 'GET',
            success: function (response) {
                $('#edit-id').val(response.siswa.id);
                $('#edit-nisn').val(response.siswa.nisn);
                $('#edit-nis').val(response.siswa.nis);
                $('#edit-nama').val(response.siswa.nama);
                $('#edit-id_kelas').val(response.siswa.id_kelas);
                $('#edit-alamat').val(response.siswa.alamat);
                $('#edit-telepon').val(response.siswa.telepon);
                $('#edit-user_id').val(response.siswa.user_id);
                $('#editSiswaModal').modal('show');
            }
        });
    });

    $('#editSiswaForm').submit(function (e) {
        e.preventDefault();
        var siswaId = $('#edit-id').val();
        var formData = new FormData(this);

        $.ajax({
            url: `/admin/siswa/${siswaId}`,
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
                alert('Data Siswa Berhasil Diperbarui');
                location.reload();
            },
            error: function (xhr) {
                alert('Terjadi kesalahan, silakan coba lagi');
            }
        });
    });
});

// preview image
function previewImage(event) {
    let input = event.target;
    let preview = document.getElementById('preview');

    if (input.files && input.files[0]) {
        let reader = new FileReader();

        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.classList.remove('d-none');
        }

        reader.readAsDataURL(input.files[0]);
    }
}
